<view class="page-container">
  <view class="header-bar">
    <text class="page-title">å‘ç¥¨ç®¡ç†</text>
    <view class="header-actions">
      <button class="ai-btn" bindtap="openAIAssistant">
        <text class="ai-icon">ğŸ¤–</text>
      </button>
    </view>
  </view>

  <scroll-view class="content-scroll" scroll-y>
    <view class="content-wrapper">
      <view class="search-section">
        <view class="search-bar">
          <text class="search-icon">ğŸ”</text>
          <input class="search-input" placeholder="æœç´¢å‘ç¥¨å·ã€å®¢æˆ·æˆ–ä¾›åº”å•†" value="{{searchKeyword}}" bindinput="onSearch" />
        </view>
      </view>

      <view class="actions-section">
        <button class="action-btn primary" bindtap="createInvoice">
          <text class="btn-icon">ğŸ“</text>
          <text class="btn-text">åˆ¶ä½œå‘ç¥¨</text>
        </button>
        <button class="action-btn secondary" bindtap="extractInvoice">
          <text class="btn-icon">ğŸ“‹</text>
          <text class="btn-text">æå–å‘ç¥¨</text>
        </button>
        <button class="action-btn ai" bindtap="aiExtractInvoice">
          <text class="btn-icon">ğŸ¤–</text>
          <text class="btn-text">AIè¯†åˆ«</text>
        </button>
      </view>

      <view class="filter-section">
        <view class="filter-tabs">
          <view class="filter-tab {{filterType === 'all' ? 'active' : ''}}" bindtap="switchFilter" data-type="all">å…¨éƒ¨</view>
          <view class="filter-tab {{filterType === 'sale' ? 'active' : ''}}" bindtap="switchFilter" data-type="sale">é”€å”®</view>
          <view class="filter-tab {{filterType === 'purchase' ? 'active' : ''}}" bindtap="switchFilter" data-type="purchase">é‡‡è´­</view>
        </view>
      </view>

      <view class="invoices-section">
        <view class="section-header">
          <text class="section-title">å‘ç¥¨åˆ—è¡¨</text>
          <view class="sort-btn" bindtap="toggleSort">
            <text class="sort-text">{{sortType === 'date' ? 'æŒ‰æ—¥æœŸ' : 'æŒ‰é‡‘é¢'}}</text>
            <text class="sort-arrow">â–¼</text>
          </view>
        </view>
        <view class="invoices-list">
          <view class="invoice-card" wx:for="{{invoices}}" wx:key="_id" bindtap="onInvoiceItemClick" data-id="{{item._id}}">
            <view class="invoice-header">
              <view class="invoice-number">{{item.invoiceNo}}</view>
              <view class="invoice-type {{item.type === 'sale' ? 'sale' : 'purchase'}}">
                {{item.type === 'sale' ? 'é”€å”®' : 'é‡‡è´­'}}
              </view>
            </view>
            <view class="invoice-body">
              <view class="invoice-row">
                <text class="row-label">{{item.type === 'sale' ? 'å®¢æˆ·' : 'ä¾›åº”å•†'}}</text>
                <text class="row-value">{{item.type === 'sale' ? item.customerName : item.supplierName}}</text>
              </view>
              <view class="invoice-row">
                <text class="row-label">æ—¥æœŸ</text>
                <text class="row-value">{{item.invoiceDate}}</text>
              </view>
              <view class="invoice-row amount">
                <text class="row-label">é‡‘é¢</text>
                <text class="row-value">Â¥{{item.totalAmount.toFixed(2)}}</text>
              </view>
            </view>
            <view class="invoice-footer">
              <view class="invoice-status {{item.status}}">
                {{item.status === 'draft' ? 'è‰ç¨¿' : item.status === 'issued' ? 'å·²å¼€å…·' : 'å·²ä½œåºŸ'}}
              </view>
              <view class="invoice-arrow">â†’</view>
            </view>
          </view>
          <view class="empty-state" wx:if="{{invoices.length === 0 && !loading}}">
            <text class="empty-icon">ğŸ“„</text>
            <text class="empty-text">æš‚æ— å‘ç¥¨æ•°æ®</text>
            <button class="empty-btn" bindtap="createInvoice">åˆ›å»ºç¬¬ä¸€å¼ å‘ç¥¨</button>
          </view>
          <view class="loading-state" wx:if="{{loading}}">
            <text class="loading-text">åŠ è½½ä¸­...</text>
          </view>
        </view>
        <view class="load-more" wx:if="{{hasMore && !loading}}" bindtap="loadInvoices">
          <text class="load-text">åŠ è½½æ›´å¤š</text>
        </view>
      </view>
    </view>
  </scroll-view>
</view>
