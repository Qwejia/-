<view class="container">
  <view class="header">
    <view class="header-left">
      <text class="page-title">é“¶è¡Œå¯¹è´¦</text>
      <text class="page-subtitle">æ™ºèƒ½å¯¹è´¦ Â· é«˜æ•ˆç®¡ç†</text>
    </view>
    <view class="header-right">
      <view class="icon-btn" bindtap="exportReport">
        <text class="icon">ğŸ“Š</text>
      </view>
      <view class="icon-btn" bindtap="onRefresh">
        <text class="icon">ğŸ”„</text>
      </view>
    </view>
  </view>

  <view class="stats-container">
    <view class="stat-card primary">
      <view class="stat-icon">
        <text>ğŸ’°</text>
      </view>
      <view class="stat-content">
        <text class="stat-label">å¯¹è´¦æ€»é¢</text>
        <text class="stat-value">Â¥65,678.88</text>
      </view>
    </view>
    <view class="stat-card success">
      <view class="stat-icon">
        <text>âœ…</text>
      </view>
      <view class="stat-content">
        <text class="stat-label">å·²å¯¹è´¦</text>
        <text class="stat-value">2</text>
      </view>
    </view>
    <view class="stat-card warning">
      <view class="stat-icon">
        <text>â³</text>
      </view>
      <view class="stat-content">
        <text class="stat-label">å¾…å¯¹è´¦</text>
        <text class="stat-value">2</text>
      </view>
    </view>
    <view class="stat-card info">
      <view class="stat-icon">
        <text>ğŸ“ˆ</text>
      </view>
      <view class="stat-content">
        <text class="stat-label">å¯¹è´¦ä¸­</text>
        <text class="stat-value">1</text>
      </view>
    </view>
  </view>

  <view class="filter-section">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢é“¶è¡Œåç§°æˆ–è´¦æˆ·" 
        value="{{searchText}}"
        bindinput="onSearchInput"
      />
    </view>
    <view class="filter-tabs">
      <view 
        class="filter-tab {{statusFilter === 'å…¨éƒ¨' ? 'active' : ''}}" 
        bindtap="onStatusFilterChange"
        data-filter="å…¨éƒ¨"
      >
        å…¨éƒ¨
      </view>
      <view 
        class="filter-tab {{statusFilter === 'å¾…å¯¹è´¦' ? 'active' : ''}}" 
        bindtap="onStatusFilterChange"
        data-filter="å¾…å¯¹è´¦"
      >
        å¾…å¯¹è´¦
      </view>
      <view 
        class="filter-tab {{statusFilter === 'å¯¹è´¦ä¸­' ? 'active' : ''}}" 
        bindtap="onStatusFilterChange"
        data-filter="å¯¹è´¦ä¸­"
      >
        å¯¹è´¦ä¸­
      </view>
      <view 
        class="filter-tab {{statusFilter === 'å·²å¯¹è´¦' ? 'active' : ''}}" 
        bindtap="onStatusFilterChange"
        data-filter="å·²å¯¹è´¦"
      >
        å·²å¯¹è´¦
      </view>
    </view>
  </view>

  <scroll-view class="reconciliation-list" scroll-y="true" refresher-enabled="{{true}}" refresher-triggered="{{refreshing}}" bindrefresherrefresh="onRefresh">
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <view wx:else>
      <view 
        wx:for="{{filteredData}}" 
        wx:key="id" 
        class="reconciliation-card"
      >
        <view class="card-header">
          <view class="bank-info">
            <view class="bank-avatar">
              <text>{{item.bankName.charAt(0)}}</text>
            </view>
            <view class="bank-details">
              <text class="bank-name">{{item.bankName}}</text>
              <text class="account-number">{{item.account}}</text>
            </view>
          </view>
          <view class="status-badge {{item.status === 'å¾…å¯¹è´¦' ? 'status-pending' : item.status === 'å¯¹è´¦ä¸­' ? 'status-processing' : 'status-completed'}}">
            {{item.status}}
          </view>
        </view>

        <view class="card-body">
          <view class="info-row">
            <text class="label">å¯¹è´¦æ—¥æœŸ</text>
            <text class="value">{{item.reconciliationDate}}</text>
          </view>
          <view class="info-row">
            <text class="label">å¯¹è´¦é‡‘é¢</text>
            <text class="value amount">Â¥{{item.amount}}</text>
          </view>
          <view class="info-row">
            <text class="label">å·®å¼‚é‡‘é¢</text>
            <text class="value {{item.difference !== '0.00' ? 'difference' : ''}}" bindtap="viewDifferenceDetails" data-id="{{item.id}}">
              Â¥{{item.difference}}
            </text>
          </view>
          <view class="info-row">
            <text class="label">äº¤æ˜“ç¬”æ•°</text>
            <text class="value">{{item.transactionCount}}ç¬”</text>
          </view>
        </view>

        <view class="card-footer">
          <view class="action-btn detail-btn" bindtap="viewDetails" data-id="{{item.id}}">
            è¯¦æƒ…
          </view>
          <view class="action-btn history-btn" bindtap="viewTransactionHistory" data-id="{{item.id}}">
            æ˜ç»†
          </view>
          <view 
            wx:if="{{item.status === 'å¾…å¯¹è´¦'}}"
            class="action-btn primary-btn" 
            bindtap="startReconciliation"
            data-id="{{item.id}}"
          >
            å¼€å§‹å¯¹è´¦
          </view>
          <view wx:else class="action-btn" style="background: #f5f5f5; color: #8c8c8c;">
            {{item.status === 'å¯¹è´¦ä¸­' ? 'å¯¹è´¦ä¸­...' : 'å·²å®Œæˆ'}}
          </view>
        </view>
      </view>

      <view wx:if="{{filteredData.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ“­</text>
        <text class="empty-text">æš‚æ— å¯¹è´¦æ•°æ®</text>
        <text class="empty-hint">ä¸‹æ‹‰åˆ·æ–°æˆ–è°ƒæ•´ç­›é€‰æ¡ä»¶</text>
      </view>
    </view>
  </scroll-view>

  <view class="fab" bindtap="onRefresh">
    <text class="fab-icon">ğŸ”„</text>
  </view>
</view>
