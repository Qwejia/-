<view class="container">
  <view class="header">
    <text class="title">å‘ç¥¨ç®¡ç†</text>
    <view class="header-actions">
      <button class="action-icon-btn" bindtap="scanInvoice">
        <text class="icon">ğŸ“·</text>
      </button>
      <button class="action-icon-btn" bindtap="exportInvoice">
        <text class="icon">ğŸ“¤</text>
      </button>
      <button class="add-btn" bindtap="addInvoice">
        <text class="icon">+</text>
        <text>æ–°å¢</text>
      </button>
    </view>
  </view>

  <view class="stats-bar">
    <view class="stat-item">
      <text class="stat-label">æ€»é‡‘é¢</text>
      <text class="stat-value amount">Â¥{{totalAmount}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">æ€»ç¨é¢</text>
      <text class="stat-value tax">Â¥{{totalTax}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">å‘ç¥¨æ•°é‡</text>
      <text class="stat-value">{{invoiceList.length}}</text>
    </view>
  </view>

  <view class="filter-bar">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢å‘ç¥¨å·ã€è´­ä¹°æ–¹ã€é”€å”®æ–¹" 
        value="{{searchText}}"
        bindinput="onSearchInput"
      />
    </view>
  </view>

  <view class="filter-row">
    <picker 
      class="filter-picker" 
      mode="selector" 
      range="{{['å…¨éƒ¨', 'å¾…è®¤è¯', 'å·²è®¤è¯', 'å·²ä½œåºŸ']}}" 
      bindchange="onStatusFilterChange"
    >
      <view class="picker-content">
        <text class="picker-label">çŠ¶æ€: {{statusFilter}}</text>
        <text class="picker-arrow">â–¼</text>
      </view>
    </picker>
    <picker 
      class="filter-picker" 
      mode="selector" 
      range="{{['å…¨éƒ¨', 'å¢å€¼ç¨ä¸“ç”¨å‘ç¥¨', 'å¢å€¼ç¨æ™®é€šå‘ç¥¨']}}" 
      bindchange="onTypeFilterChange"
    >
      <view class="picker-content">
        <text class="picker-label">ç±»å‹: {{typeFilter}}</text>
        <text class="picker-arrow">â–¼</text>
      </view>
    </picker>
  </view>

  <view class="batch-actions" wx:if="{{showBatchActions}}">
    <text class="selected-count">å·²é€‰æ‹© {{selectedInvoices.length}} å¼ å‘ç¥¨</text>
    <view class="batch-buttons">
      <button class="batch-btn cancel-btn" bindtap="cancelSelection">å–æ¶ˆ</button>
      <button class="batch-btn confirm-btn" bindtap="batchVerify">æ‰¹é‡è®¤è¯</button>
    </view>
  </view>

  <view class="content">
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <scroll-view wx:else class="invoice-list" scroll-y="true" refresher-enabled="{{true}}" refresher-triggered="{{refreshing}}" bindrefresherrefresh="onPullDownRefresh">
      <view 
        wx:for="{{filteredList}}" 
        wx:key="id" 
        class="invoice-card {{item.status}} {{selectedInvoices.includes(item.id) ? 'selected' : ''}}"
        data-id="{{item.id}}"
        bindtap="onSelectInvoice"
      >
        <view class="card-header">
          <view class="invoice-info">
            <view class="checkbox {{selectedInvoices.includes(item.id) ? 'checked' : ''}}">
              <text wx:if="{{selectedInvoices.includes(item.id)}}">âœ“</text>
            </view>
            <view class="invoice-details">
              <text class="invoice-no">{{item.invoiceNo}}</text>
              <text class="invoice-type">{{item.invoiceType}}</text>
            </view>
          </view>
          <view class="status-badge {{item.status === 'å¾…è®¤è¯' ? 'status-pending' : item.status === 'å·²è®¤è¯' ? 'status-verified' : 'status-cancelled'}}">
            {{item.status}}
          </view>
        </view>

        <view class="card-body">
          <view class="info-row">
            <text class="label">è´­ä¹°æ–¹</text>
            <text class="value">{{item.buyerName}}</text>
          </view>
          <view class="info-row">
            <text class="label">é”€å”®æ–¹</text>
            <text class="value">{{item.sellerName}}</text>
          </view>
          <view class="info-row">
            <text class="label">é‡‘é¢</text>
            <text class="value amount">Â¥{{item.amount}}</text>
          </view>
          <view class="info-row">
            <text class="label">ç¨é¢</text>
            <text class="value tax">Â¥{{item.tax}}</text>
          </view>
          <view class="info-row">
            <text class="label">ä»·ç¨åˆè®¡</text>
            <text class="value total">Â¥{{item.totalAmount}}</text>
          </view>
          <view class="info-row">
            <text class="label">å¼€ç¥¨æ—¥æœŸ</text>
            <text class="value">{{item.invoiceDate}}</text>
          </view>
          <view class="info-row">
            <text class="label">ç±»åˆ«</text>
            <text class="value category">{{item.category}}</text>
          </view>
        </view>

        <view class="card-footer">
          <button 
            class="action-btn detail-btn" 
            bindtap="viewInvoiceDetail"
            data-id="{{item.id}}"
            catchtap="true"
          >
            æŸ¥çœ‹è¯¦æƒ…
          </button>
          <button 
            wx:if="{{item.status === 'å¾…è®¤è¯'}}"
            class="action-btn primary-btn" 
            bindtap="verifyInvoice"
            data-id="{{item.id}}"
            catchtap="true"
          >
            è®¤è¯
          </button>
          <view wx:else class="action-btn disabled-btn">
            {{item.status === 'å·²è®¤è¯' ? 'å·²è®¤è¯' : 'å·²ä½œåºŸ'}}
          </view>
        </view>
      </view>

      <view wx:if="{{filteredList.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ“„</text>
        <text class="empty-text">{{searchText || statusFilter !== 'å…¨éƒ¨' || typeFilter !== 'å…¨éƒ¨' ? 'æœªæ‰¾åˆ°åŒ¹é…çš„å‘ç¥¨' : 'æš‚æ— å‘ç¥¨æ•°æ®'}}</text>
      </view>
    </scroll-view>
  </view>
</view>