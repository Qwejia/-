<!-- pages/generalLedger/ledger.wxml -->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">æ€»è´¦ç®¡ç†</text>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input type="text" placeholder="æœç´¢ç§‘ç›®ä»£ç æˆ–åç§°" value="{{searchKeyword}}" bindinput="onSearch" class="search-input" />
    </view>
  </view>
  
  <!-- ç­›é€‰æ¡ä»¶ -->
  <view class="filter-section">
    <view class="filter-row">
      <view class="filter-item">
        <text class="label">ç§‘ç›®ç±»åˆ«</text>
        <picker mode="selector" range="{{categoryOptions}}" range-key="text" value="{{categoryFilter}}" bindchange="onCategoryChange" class="picker">
          <view class="picker-text">{{categoryOptions[categoryFilter || 0].text}}</view>
        </picker>
      </view>
      <view class="filter-item">
        <text class="label">æœŸé—´</text>
        <picker mode="selector" range="{{periodOptions}}" range-key="text" value="{{periodIndex}}" bindchange="onPeriodChange" class="picker">
          <view class="picker-text">{{periodText}}</view>
        </picker>
      </view>
    </view>
  </view>
  
  <!-- å¿«æ·æ“ä½œæŒ‰é’® -->
  <view class="quick-actions-section">
    <view class="quick-actions-container">
      <!-- å¯è§çš„æ“ä½œæŒ‰é’® -->
      <view wx:for="{{visibleActions}}" wx:key="id" class="quick-action-btn" bindtap="handleQuickAction" data-action="{{item.action}}">
        <text class="action-icon">{{item.icon}}</text>
        <text class="action-name">{{item.name}}</text>
      </view>
      
      <!-- æ›´å¤š/æ”¶èµ·æŒ‰é’® -->
      <view class="quick-action-more" bindtap="toggleMoreActions">
        <text class="more-icon">{{showMoreActions ? 'ğŸ“‹' : 'â•'}}</text>
        <text class="more-name">{{showMoreActions ? 'æ”¶èµ·' : 'æ›´å¤š'}}</text>
      </view>
    </view>
  </view>

  <!-- æ€»è´¦åˆ—è¡¨ -->
  <view class="ledger-section">
    <view class="section-header">
      <text class="title">æ€»è´¦</text>
    </view>
    
    <view class="ledger-header">
      <text class="header-item code">ç§‘ç›®ä»£ç </text>
      <text class="header-item name">ç§‘ç›®åç§°</text>
      <text class="header-item category">ç±»åˆ«</text>
      <text class="header-item amount">å€Ÿæ–¹å‘ç”Ÿé¢</text>
      <text class="header-item amount">è´·æ–¹å‘ç”Ÿé¢</text>
      <text class="header-item amount balance">ä½™é¢</text>
    </view>
    
    <view class="ledger-list" bindscrolltolower="loadMoreLedger" bindscroll="onScroll">
      <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
      <view wx:if="{{loading}}" class="loading-state">
        <view class="loading-animation">
          <view class="loading-circle"></view>
          <view class="loading-circle"></view>
          <view class="loading-circle"></view>
        </view>
        <text class="loading-text">æ­£åœ¨åŠ è½½æ€»è´¦æ•°æ®...</text>
        
        <!-- åŠ è½½è¿›åº¦æ¡ -->
        <view wx:if="{{showProgress}}" class="progress-container">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{loadingProgress}}%"></view>
          </view>
          <text class="progress-text">{{loadingProgress}}%</text>
        </view>
      </view>
      
      <!-- æ­£å¸¸æ•°æ®åˆ—è¡¨ -->
      <view wx:elif="{{ledgerData.length > 0}}" class="data-list">
        <view wx:for="{{ledgerData}}" wx:key="account._id" class="ledger-item" bindtap="viewSubLedger" data-id="{{item.account._id}}">
          <text class="item-code">{{item.account.code}}</text>
          <text class="item-name">{{item.account.name}}</text>
          <text class="item-category">{{item.categoryName}}</text>
          <text class="item-debit">Â¥{{item.debitAmount.toFixed(2)}}</text>
          <text class="item-credit">Â¥{{item.creditAmount.toFixed(2)}}</text>
          <text class="item-balance {{item.balance >= 0 ? 'debit' : 'credit'}}">Â¥{{item.balance.toFixed(2)}}</text>
        </view>
        
        <!-- åŠ è½½æ›´å¤šæŒ‡ç¤ºå™¨ -->
        <view wx:if="{{loadingMore}}" class="loading-more">
          <text class="loading-more-text">åŠ è½½æ›´å¤š...</text>
        </view>
        
        <!-- æ²¡æœ‰æ›´å¤šæ•°æ®æç¤º -->
        <view wx:if="{{!hasMoreData && !loadingMore}}" class="no-more">
          <text class="no-more-text">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
        </view>
        
        <!-- æ€»é‡‘é¢è¡Œ -->
        <view class="total-row">
          <text class="total-label">åˆè®¡</text>
          <text class="total-spacer"></text>
          <text class="total-spacer"></text>
          <text class="total-debit">Â¥{{totalDebit.toFixed(2)}}</text>
          <text class="total-credit">Â¥{{totalCredit.toFixed(2)}}</text>
          <text class="total-balance"></text>
        </view>
      </view>
      
      <!-- é”™è¯¯çŠ¶æ€ -->
      <view wx:elif="{{error}}" class="empty-state error">
        <text class="empty-icon">âŒ</text>
        <text class="empty-text">åŠ è½½å¤±è´¥</text>
        <text class="empty-subtext">{{error}}</text>
        <button class="retry-btn" bindtap="loadLedgerData">é‡è¯•</button>
      </view>
      
      <!-- ç©ºæ•°æ®çŠ¶æ€ -->
      <view wx:else class="empty-state">
        <view class="empty-container">
          <text class="empty-icon">ğŸ“Š</text>
          <text class="empty-text">æš‚æ— æ€»è´¦æ•°æ®</text>
          <text class="empty-subtext">
            {{searchKeyword ? 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç§‘ç›®' : 'å½“å‰æ¡ä»¶ä¸‹æ²¡æœ‰æ€»è´¦è®°å½•'}}
          </text>
          <text class="empty-subtext">
            {{searchKeyword ? 'è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯' : 'è¯·è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–æ·»åŠ æ–°çš„å‡­è¯'}}
          </text>
          <button wx:if="{{searchKeyword}}" class="reset-btn" bindtap="resetSearch">
            æ¸…é™¤æœç´¢
          </button>
        </view>
      </view>
    </view>
  </view>
</view>
