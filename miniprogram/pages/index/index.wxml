<view class="page-container">
  <view class="header-bar">
    <view class="header-left">
      <text class="greeting">{{greeting}}</text>
      <text class="date">{{currentDate}}</text>
    </view>
    <view class="header-right">
      <view class="ai-btn" bindtap="navigateToAIAssistant">
        <text class="ai-icon">ğŸ¤–</text>
      </view>
    </view>
  </view>

  <scroll-view class="content-scroll" scroll-y>
    <view class="content-wrapper">
      <view class="entity-section">
        <view class="entity-card">
          <view class="entity-header">
            <text class="entity-title">{{entityName}}</text>
            <view class="period-badge" bindtap="openPeriodSelector">
              <text class="period-text">{{currentPeriod}}</text>
              <text class="period-arrow">â–¼</text>
            </view>
          </view>
        </view>
      </view>

      <view class="metrics-section">
        <view class="metrics-grid">
          <view class="metric-item income">
            <view class="metric-header">
              <text class="metric-label">æœ¬æœŸæ”¶å…¥</text>
              <text class="metric-icon">ğŸ“ˆ</text>
            </view>
            <text class="metric-value">Â¥{{currentPeriodIncome}}</text>
            <view class="metric-trend {{incomeChangeClass}}">
              <text>{{incomeChangeText}}</text>
              <text>{{incomeChangeAbs}}%</text>
            </view>
          </view>
          <view class="metric-item expense">
            <view class="metric-header">
              <text class="metric-label">æœ¬æœŸæ”¯å‡º</text>
              <text class="metric-icon">ğŸ“‰</text>
            </view>
            <text class="metric-value">Â¥{{currentPeriodExpense}}</text>
            <view class="metric-trend {{expenseChangeClass}}">
              <text>{{expenseChangeText}}</text>
              <text>{{expenseChangeAbs}}%</text>
            </view>
          </view>
          <view class="metric-item profit">
            <view class="metric-header">
              <text class="metric-label">æœ¬æœŸåˆ©æ¶¦</text>
              <text class="metric-icon">ğŸ’°</text>
            </view>
            <text class="metric-value">Â¥{{currentPeriodProfit}}</text>
            <view class="metric-trend {{profitChangeClass}}">
              <text>{{profitChangeText}}</text>
              <text>{{profitChangeAbs}}%</text>
            </view>
          </view>
        </view>
      </view>

      <view class="overview-section">
        <view class="section-header">
          <text class="section-title">è´¢åŠ¡æ¦‚è§ˆ</text>
          <navigator url="/pages/statistics/index" class="more-link">æŸ¥çœ‹æŠ¥è¡¨</navigator>
        </view>
        <view class="overview-grid">
          <view class="overview-card">
            <text class="card-label">æ€»èµ„äº§</text>
            <text class="card-amount">Â¥{{totalAssets}}</text>
          </view>
          <view class="overview-card">
            <text class="card-label">æ€»è´Ÿå€º</text>
            <text class="card-amount">Â¥{{totalLiabilities}}</text>
          </view>
          <view class="overview-card">
            <text class="card-label">å‡€èµ„äº§</text>
            <text class="card-amount equity">Â¥{{netAssets}}</text>
          </view>
        </view>
      </view>

      <view class="quick-actions-section">
        <view class="section-header">
          <text class="section-title">å¿«æ·æ“ä½œ</text>
        </view>
        <view class="actions-grid">
          <navigator url="/pages/record/index?type=income" class="action-card">
            <view class="action-icon-wrapper income">
              <text class="action-icon">ğŸ’µ</text>
            </view>
            <text class="action-label">è®°æ”¶å…¥</text>
          </navigator>
          <navigator url="/pages/record/index?type=expense" class="action-card">
            <view class="action-icon-wrapper expense">
              <text class="action-icon">ğŸ’¸</text>
            </view>
            <text class="action-label">è®°æ”¯å‡º</text>
          </navigator>
          <navigator url="/pages/generalLedger/voucherEntry" class="action-card">
            <view class="action-icon-wrapper voucher">
              <text class="action-icon">ğŸ“</text>
            </view>
            <text class="action-label">å½•å…¥å‡­è¯</text>
          </navigator>
          <navigator url="/pages/finance/invoice" class="action-card">
            <view class="action-icon-wrapper invoice">
              <text class="action-icon">ğŸ§¾</text>
            </view>
            <text class="action-label">å‘ç¥¨ç®¡ç†</text>
          </navigator>
          <navigator url="/pages/finance/tax" class="action-card">
            <view class="action-icon-wrapper tax">
              <text class="action-icon">ğŸ“‹</text>
            </view>
            <text class="action-label">ç¨åŠ¡ç”³æŠ¥</text>
          </navigator>
          <navigator url="/pages/generalLedger/index" class="action-card">
            <view class="action-icon-wrapper ledger">
              <text class="action-icon">ğŸ“‹</text>
            </view>
            <text class="action-label">æŸ¥çœ‹æ€»è´¦</text>
          </navigator>
          <navigator url="/pages/accountsReceivable/index" class="action-card">
            <view class="action-icon-wrapper ar">
              <text class="action-icon">ğŸ’°</text>
            </view>
            <text class="action-label">åº”æ”¶ç®¡ç†</text>
          </navigator>
          <navigator url="/pages/accountsPayable/index" class="action-card">
            <view class="action-icon-wrapper ap">
              <text class="action-icon">ğŸ’³</text>
            </view>
            <text class="action-label">åº”ä»˜ç®¡ç†</text>
          </navigator>
        </view>
      </view>

      <view class="chart-section">
        <view class="section-header">
          <text class="section-title">è´¢åŠ¡è¶‹åŠ¿</text>
          <view class="chart-toggle" bindtap="toggleChartType">
            <text class="chart-type">{{chartTypeText}}</text>
          </view>
        </view>
        <view class="chart-wrapper">
          <canvas canvas-id="trendChart" class="chart-canvas"></canvas>
        </view>
      </view>

      <view class="insight-section">
        <view class="section-header">
          <text class="section-title">AIè´¢åŠ¡æ´å¯Ÿ</text>
          <view class="refresh-btn" bindtap="refreshAIInsight">
            <text class="refresh-icon">ğŸ”„</text>
          </view>
        </view>
        <view class="insight-card">
          <view class="insight-content">
            <text class="insight-text">{{currentInsightText}}</text>
          </view>
        </view>
      </view>

      <view class="activities-section">
        <view class="section-header">
          <text class="section-title">è¿‘æœŸæ´»åŠ¨</text>
          <navigator url="/pages/record/index" class="more-link">æŸ¥çœ‹å…¨éƒ¨</navigator>
        </view>
        <view class="tab-bar">
          <view class="tab-item {{activeTab === 'all' ? 'active' : ''}}" bindtap="switchTab" data-tab="all">å…¨éƒ¨</view>
          <view class="tab-item {{activeTab === 'income' ? 'active' : ''}}" bindtap="switchTab" data-tab="income">æ”¶å…¥</view>
          <view class="tab-item {{activeTab === 'expense' ? 'active' : ''}}" bindtap="switchTab" data-tab="expense">æ”¯å‡º</view>
        </view>
        <view class="activities-list">
          <view class="activity-row" wx:for="{{activities}}" wx:key="index">
            <view class="activity-icon">{{item.icon}}</view>
            <view class="activity-info">
              <text class="activity-title">{{item.title}}</text>
              <text class="activity-date">{{item.date}}</text>
            </view>
            <text class="activity-amount {{item.type === 'income' ? 'income' : 'expense'}}">{{item.type === 'income' ? '+' : '-'}}Â¥{{item.amount}}</text>
          </view>
          <view class="empty-activities" wx:if="{{activities.length === 0}}">
            <text class="empty-text">æš‚æ— æ´»åŠ¨è®°å½•</text>
          </view>
        </view>
      </view>

      <view class="calendar-section">
        <view class="section-header">
          <text class="section-title">ä¼šè®¡æ—¥å†</text>
        </view>
        <view class="calendar-grid">
          <view class="calendar-item">
            <text class="calendar-label">è®°è´¦æˆªæ­¢</text>
            <text class="calendar-date">{{bookkeepingDeadline}}</text>
          </view>
          <view class="calendar-item">
            <text class="calendar-label">æŠ¥è¡¨ç”Ÿæˆ</text>
            <text class="calendar-date">{{reportGeneration}}</text>
          </view>
          <view class="calendar-item">
            <text class="calendar-label">æŠ¥ç¨æˆªæ­¢</text>
            <text class="calendar-date">{{taxDeadline}}</text>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>
</view>
