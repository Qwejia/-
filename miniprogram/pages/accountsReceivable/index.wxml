<!-- pages/accountsReceivable/index.wxml -->
<view class="container">
  <view class="header-section">
    <view class="header-title">
      <text class="title">åº”æ”¶æ¬¾ç®¡ç†</text>
      <button class="ai-assistant-btn" bindtap="openAIAssistant">
        <view class="ai-btn-icon">ğŸ¤–</view>
        <text class="ai-btn-text">AIåŠ©æ‰‹</text>
      </button>
    </view>
    <view class="summary-section">
      <view class="summary-card">
        <view class="summary-label">å®¢æˆ·æ•°é‡</view>
        <view class="summary-value">{{customers.length}}</view>
      </view>
      <view class="summary-card">
        <view class="summary-label">åº”æ”¶å•</view>
        <view class="summary-value">{{arInvoices.length}}</view>
      </view>
      <view class="summary-card">
        <view class="summary-label">æ”¶æ¬¾å•</view>
        <view class="summary-value">{{arReceipts.length}}</view>
      </view>
    </view>
  </view>
  
  <!-- AIæé†’åŒºåŸŸ -->
  <view class="ai-reminder-section">
    <view class="section-header">
      <text class="header-text">AIæé†’</text>
      <button class="refresh-btn" bindtap="refreshAIReminders">
        <text class="refresh-text">åˆ·æ–°</text>
      </button>
    </view>
    <view class="reminder-list">
      <view wx:for="{{aiReminders}}" wx:key="index" class="reminder-item" data-type="{{item.type}}" data-id="{{item.id}}">
        <view class="reminder-icon">{{item.icon}}</view>
        <view class="reminder-content">
          <view class="reminder-title">{{item.title}}</view>
          <view class="reminder-desc">{{item.description}}</view>
          <view class="reminder-amount">{{item.amount}}</view>
        </view>
        <view class="reminder-action">
          <button class="action-btn" bindtap="handleReminderAction">å¤„ç†</button>
        </view>
      </view>
      <view wx:if="{{aiReminders.length === 0}}" class="empty-reminder">
        <view class="empty-icon">âœ…</view>
        <text class="empty-text">æš‚æ— å¾…å¤„ç†äº‹é¡¹</text>
      </view>
    </view>
  </view>
  
  <view class="menu-section">
    <view class="menu-grid">
      <view wx:for="{{menuItems}}" wx:key="id" class="menu-item" bindtap="navigateToPage" data-path="{{item.path}}">
        <view class="menu-icon">{{item.icon}}</view>
        <view class="menu-name">{{item.name}}</view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½æ¨¡å—å¿«é€Ÿè®¿é—® -->
  <view class="quick-access-section">
    <view class="section-header">
      <text class="header-text">åŠŸèƒ½æ¨¡å—</text>
    </view>
    <view class="quick-access-grid">
      <navigator url="/pages/generalLedger/index" class="quick-access-item">
        <view class="quick-icon">ğŸ“‹</view>
        <view class="quick-name">æ€»è´¦ç®¡ç†</view>
      </navigator>
      <navigator url="/pages/category/index" class="quick-access-item">
        <view class="quick-icon">ğŸ·ï¸</view>
        <view class="quick-name">åˆ†ç±»ç®¡ç†</view>
      </navigator>
      <navigator url="/pages/statistics/index" class="quick-access-item">
        <view class="quick-icon">ğŸ“Š</view>
        <view class="quick-name">æ”¶æ”¯ç»Ÿè®¡</view>
      </navigator>
      <navigator url="/pages/record/index" class="quick-access-item">
        <view class="quick-icon">âœï¸</view>
        <view class="quick-name">æ–°å¢è®°å½•</view>
      </navigator>
    </view>
  </view>
  
  <!-- åº”æ”¶è´¦æ¬¾æ±‡æ€»æŠ¥è¡¨ -->
  <view class="summary-report-section">
    <view class="section-header">
      <text class="header-text">åº”æ”¶è´¦æ¬¾æ±‡æ€»</text>
      <button class="refresh-btn" bindtap="refreshSummaryReport">
        <icon type="refresh" size="16"></icon>åˆ·æ–°
      </button>
    </view>
    
    <view class="report-cards">
      <view class="report-card">
        <view class="report-icon">ğŸ’°</view>
        <view class="report-content">
          <view class="report-label">åº”æ”¶æ€»é¢</view>
          <view class="report-value">Â¥{{summaryReport.totalAmount.toFixed(2)}}</view>
        </view>
      </view>
      
      <view class="report-card">
        <view class="report-icon">âœ…</view>
        <view class="report-content">
          <view class="report-label">å·²æ ¸é”€é‡‘é¢</view>
          <view class="report-value">Â¥{{summaryReport.writtenOffAmount.toFixed(2)}}</view>
        </view>
      </view>
      
      <view class="report-card">
        <view class="report-icon">â°</view>
        <view class="report-content">
          <view class="report-label">æœªæ ¸é”€é‡‘é¢</view>
          <view class="report-value">Â¥{{summaryReport.outstandingAmount.toFixed(2)}}</view>
        </view>
      </view>
      
      <view class="report-card">
        <view class="report-icon">ğŸ“ˆ</view>
        <view class="report-content">
          <view class="report-label">æ ¸é”€ç‡</view>
          <view class="report-value">{{summaryReport.writeOffRate.toFixed(1)}}%</view>
        </view>
      </view>
    </view>
    
    <!-- è´¦é¾„åˆ†å¸ƒ -->
    <view class="aging-distribution">
      <view class="distribution-title">è´¦é¾„åˆ†å¸ƒ</view>
      <view class="distribution-chart">
        <view class="distribution-item" wx:for="{{summaryReport.agingDistribution}}" wx:key="name">
          <view class="distribution-label">{{item.name}}</view>
          <view class="distribution-bar">
            <view class="bar-fill" style="width: {{item.percentage}}%; background-color: {{item.color}};"></view>
          </view>
          <view class="distribution-value">Â¥{{item.amount.toFixed(2)}}</view>
        </view>
      </view>
    </view>
    
    <!-- é€¾æœŸç»Ÿè®¡ -->
    <view class="overdue-section">
      <view class="overdue-title">é€¾æœŸç»Ÿè®¡</view>
      <view class="overdue-cards">
        <view class="overdue-card">
          <view class="overdue-label">é€¾æœŸç¬”æ•°</view>
          <view class="overdue-value">{{summaryReport.overdueCount}}</view>
        </view>
        <view class="overdue-card">
          <view class="overdue-label">é€¾æœŸé‡‘é¢</view>
          <view class="overdue-value">Â¥{{summaryReport.overdueAmount.toFixed(2)}}</view>
        </view>
        <view class="overdue-card">
          <view class="overdue-label">æœ€å¤§é€¾æœŸå¤©æ•°</view>
          <view class="overdue-value">{{summaryReport.maxOverdueDays}}å¤©</view>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- AIåŠ©æ‰‹å¼¹çª— -->
<view class="ai-assistant-modal" wx:if="{{showAIAssistant}}">
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">AIåº”æ”¶åŠ©æ‰‹</text>
      <button class="close-btn" bindtap="closeAIAssistant">âœ•</button>
    </view>
    <view class="modal-body">
      <view class="ai-chat-container">
        <view class="chat-messages">
          <view wx:for="{{aiChatMessages}}" wx:key="index" class="chat-message {{item.role === 'assistant' ? 'assistant-message' : 'user-message'}}">
            <view class="message-content">{{item.content}}</view>
          </view>
          <view wx:if="{{isAILoading}}" class="chat-message assistant-message">
            <view class="message-content">
              <view class="loading-dots">
                <view class="dot"></view>
                <view class="dot"></view>
                <view class="dot"></view>
              </view>
            </view>
          </view>
        </view>
        <view class="chat-input">
          <input type="text" class="input-field" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜ï¼Œå¦‚ï¼šå¦‚ä½•å¤„ç†é€¾æœŸåº”æ”¶è´¦æ¬¾ï¼Ÿ" value="{{aiQuestion}}" bindinput="onAIQuestionInput" />
          <button class="send-btn" bindtap="sendAIQuestion" disabled="{{isAILoading || !aiQuestion.trim()}}">
            <text class="send-text">å‘é€</text>
          </button>
        </view>
      </view>
    </view>
  </view>
</view>
