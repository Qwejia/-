<!-- ä»»åŠ¡è¯¦æƒ…é¡µé¢ -->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="back-btn" bindtap="onBack">
      <text>â†</text>
    </view>
    <text class="title">ä»»åŠ¡è¯¦æƒ…</text>
    <view class="header-right">
      <text class="header-icon">ğŸ“‹</text>
    </view>
  </view>

  <!-- ä»»åŠ¡çŠ¶æ€å¡ç‰‡ -->
  <view class="status-card" style="background: {{getStatusColor(task.status)}};">
    <text class="status-text">{{getStatusText(task.status)}}</text>
    <text class="status-desc">{{getStatusDescription(task.status)}}</text>
  </view>

  <!-- ä»»åŠ¡ä¿¡æ¯å¡ç‰‡ -->
  <view class="task-card">
    <view class="task-header">
      <text class="task-title">{{task.title}}</text>
      <view class="task-meta">
        <view class="meta-item">
          <text class="meta-icon">ğŸ’¼</text>
          <text class="meta-text">{{getServiceText(task.service)}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-icon">ğŸ’°</text>
          <text class="meta-text">{{getBudgetText(task.budget)}}</text>
        </view>
      </view>
    </view>

    <!-- ä»»åŠ¡æè¿° -->
    <view class="task-description">
      <text class="section-title">ä»»åŠ¡æè¿°</text>
      <text class="description-text">{{task.description}}</text>
    </view>

    <!-- ä»»åŠ¡ä¿¡æ¯ -->
    <view class="task-info">
      <view class="info-row">
        <text class="info-label">æˆªæ­¢æ—¥æœŸï¼š</text>
        <text class="info-value">{{task.deadline}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">è”ç³»æ–¹å¼ï¼š</text>
        <text class="info-value">{{task.contact}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">å‘å¸ƒæ—¶é—´ï¼š</text>
        <text class="info-value">{{formatTime(task.createdAt)}}</text>
      </view>
    </view>

    <!-- é™„ä»¶ä¿¡æ¯ -->
    <view class="task-attachments" wx:if="task.files && task.files.length > 0">
      <text class="section-title">é™„ä»¶</text>
      <view class="file-list">
        <view class="file-item" wx:for="{{task.files}}" wx:key="index">
          <text class="file-icon">ğŸ“„</text>
          <view class="file-info">
            <text class="file-name">{{item.name}}</text>
            <text class="file-size">{{item.size}}</text>
          </view>
          <view class="file-action">
            <text class="download-text">ä¸‹è½½</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä»»åŠ¡è¿›å±• -->
  <view class="progress-section" wx:if="task.progress && task.progress.length > 0">
    <text class="section-title">ä»»åŠ¡è¿›å±•</text>
    <view class="progress-list">
      <view class="progress-item" wx:for="{{task.progress}}" wx:key="index">
        <view class="progress-header">
          <text class="progress-title">{{item.title}}</text>
          <text class="progress-date">{{item.date}}</text>
        </view>
        <text class="progress-content">{{item.content}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar" wx:if="task.status === 'pending' || task.status === 'processing'">
    <button class="action-btn" bindtap="cancelTask" wx:if="task.status === 'pending'" style="background: #ef4444;">
      <text class="btn-text">å–æ¶ˆä»»åŠ¡</text>
    </button>
    <button class="action-btn" bindtap="completeTask" wx:if="task.status === 'processing'" style="background: #10b981;">
      <text class="btn-text">ç¡®è®¤å®Œæˆ</text>
    </button>
    <button class="action-btn" bindtap="addProgress" style="background: #3b82f6;">
      <text class="btn-text">æ·»åŠ è¿›å±•</text>
    </button>
  </view>

  <!-- è¯„ä»·è¡¨å• -->
  <view class="review-section" wx:if="task.status === 'completed' && !task.reviewed">
    <text class="section-title">è¯„ä»·æœåŠ¡</text>
    <view class="review-form">
      <view class="rating-section">
        <text class="rating-label">è¯„åˆ†ï¼š</text>
        <view class="rating-stars">
          <text class="star {{selectedRating >= 1 ? 'active' : ''}}" bindtap="selectRating" data-rating="1">â­</text>
          <text class="star {{selectedRating >= 2 ? 'active' : ''}}" bindtap="selectRating" data-rating="2">â­</text>
          <text class="star {{selectedRating >= 3 ? 'active' : ''}}" bindtap="selectRating" data-rating="3">â­</text>
          <text class="star {{selectedRating >= 4 ? 'active' : ''}}" bindtap="selectRating" data-rating="4">â­</text>
          <text class="star {{selectedRating >= 5 ? 'active' : ''}}" bindtap="selectRating" data-rating="5">â­</text>
        </view>
      </view>
      <view class="review-content-section">
        <text class="content-label">è¯„ä»·å†…å®¹ï¼š</text>
        <textarea class="review-content" placeholder="è¯·è¾“å…¥æ‚¨çš„è¯„ä»·å†…å®¹" value="{{reviewContent}}" bindinput="onReviewContentInput" />
      </view>
      <button class="submit-review-btn" bindtap="submitReview" style="background: #1677ff;">
        <text class="btn-text">æäº¤è¯„ä»·</text>
      </button>
    </view>
  </view>
</view>

<!-- æ·»åŠ è¿›å±•æ¨¡æ€æ¡† -->
<view class="modal" wx:if="showProgressModal">
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">æ·»åŠ ä»»åŠ¡è¿›å±•</text>
      <view class="close-btn" bindtap="closeProgressModal">âœ•</view>
    </view>
    <view class="modal-body">
      <input class="progress-title-input" placeholder="è¿›å±•æ ‡é¢˜" value="{{progressTitle}}" bindinput="onProgressTitleInput" />
      <textarea class="progress-content-input" placeholder="è¿›å±•å†…å®¹" value="{{progressContent}}" bindinput="onProgressContentInput" />
    </view>
    <view class="modal-footer">
      <button class="footer-btn cancel" bindtap="closeProgressModal">å–æ¶ˆ</button>
      <button class="footer-btn confirm" bindtap="submitProgress">æäº¤</button>
    </view>
  </view>
</view>