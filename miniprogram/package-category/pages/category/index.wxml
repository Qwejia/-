<view class="container">
  <!-- 页面头部 -->
  <view class="header">
    <view class="back-btn" bindtap="onBack">
      <text>←</text>
    </view>
    <text class="title">分类管理</text>
    <view class="header-right">
      <text class="header-icon">⚙️</text>
    </view>
  </view>

  <!-- 分类类型切换 -->
  <view class="tab-section">
    <view class="tab-bar">
      <view class="tab-item {{activeTab === 'expense' ? 'active' : ''}}" bindtap="switchTab" data-tab="expense">
        <text class="tab-icon">💰</text>
        <text class="tab-text">支出分类</text>
      </view>
      <view class="tab-item {{activeTab === 'income' ? 'active' : ''}}" bindtap="switchTab" data-tab="income">
        <text class="tab-icon">📈</text>
        <text class="tab-text">收入分类</text>
      </view>
    </view>
  </view>

  <!-- 分类列表区域 -->
  <view class="category-list-container">
    <!-- 分类列表 -->
    <view wx:if="{{categories.length > 0}}" class="category-list">
      <view class="category-item" 
        wx:for="{{categories}}" 
        wx:key="_id" 
        data-id="{{item._id}}" 
        data-index="{{index}}">
        <view class="category-content">
          <view class="category-left">
            <view class="drag-handle" bindtouchstart="onTouchStart" bindtouchend="onTouchEnd">☰</view>
            <view class="category-icon">
              <text>{{item.icon}}</text>
            </view>
            <view class="category-info">
              <text class="category-name">{{item.name}}</text>
              <text class="category-sort">排序: {{item.sort || 0}}</text>
            </view>
          </view>
          <view class="category-actions">
            <view class="action-btn edit" bindtap="editCategory" data-id="{{item._id}}">
              <text class="action-icon">✏️</text>
              <text class="action-text">编辑</text>
            </view>
            <view class="action-btn delete" bindtap="deleteCategory" data-id="{{item._id}}">
              <text class="action-icon">🗑️</text>
              <text class="action-text">删除</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{categories.length === 0}}">
      <text class="empty-icon">📁</text>
      <text class="empty-title">暂无分类</text>
      <text class="empty-subtitle">点击下方按钮添加您的第一个分类</text>
    </view>
  </view>

  <!-- 添加分类按钮 -->
  <view class="add-section">
    <button class="add-btn" bindtap="addCategory" aria-label="添加新分类">
      <text class="add-icon">➕</text>
      <text class="add-text">添加分类</text>
    </button>
  </view>

  <!-- 编辑/添加分类弹窗 -->
  <view class="modal-mask" wx:if="{{editModalVisible}}" catchtap="closeModal"></view>
  <view class="modal-container" wx:if="{{editModalVisible}}" role="dialog" aria-modal="true">
    <view class="modal-header">
      <text class="modal-title">{{editCategory ? '编辑分类' : '添加分类'}}</text>
      <view class="modal-close" bindtap="closeModal" aria-label="关闭弹窗">✕</view>
    </view>
    
    <view class="modal-content">
      <!-- 分类名称输入 -->
      <view class="form-item">
        <text class="form-label">分类名称</text>
        <input type="text" 
               class="form-input" 
               placeholder="请输入分类名称" 
               value="{{newCategory.name}}" 
               bindinput="onNameInput" 
               maxlength="10" 
               aria-required="true" 
               placeholder-class="form-input-placeholder" />
      </view>
      
      <!-- 图标选择 -->
      <view class="form-item">
        <text class="form-label">选择图标</text>
        <view class="icon-grid">
          <view class="icon-item {{newCategory.icon === item ? 'selected' : ''}}" 
                wx:for="{{availableIcons}}" 
                wx:key="index" 
                bindtap="selectIcon" 
                data-icon="{{item}}" 
                role="button" 
                aria-pressed="{{newCategory.icon === item}}">
            <text class="icon">{{item}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 弹窗底部按钮 -->
    <view class="modal-footer">
      <button class="modal-btn cancel" bindtap="closeModal">取消</button>
      <button class="modal-btn confirm" 
              bindtap="saveCategory" 
              disabled="{{!newCategory.name.trim() || !newCategory.icon}}" 
              aria-disabled="{{!newCategory.name.trim() || !newCategory.icon}}">
        {{editCategory ? '保存修改' : '添加'}}
      </button>
    </view>
  </view>
</view>