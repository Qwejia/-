# 小程序项目架构设计

## 1. 项目概述

本项目基于用友U8系统的功能模块，将其拆解并迁移到小程序中，实现企业管理系统的移动化应用。系统涵盖财务会计、供应链管理、生产制造、人力资源等核心模块，为企业提供全方位的管理解决方案。

## 2. 系统架构

### 2.1 技术架构

- **前端框架**：微信小程序原生框架
- **后端服务**：云开发（CloudBase）
- **数据存储**：云数据库（JSON格式）
- **文件存储**：云存储
- **API接口**：云函数

### 2.2 模块划分

| 模块类别 | 模块名称 | 功能描述 | 文件路径 |
|---------|---------|---------|----------|
| **基础模块** | 用户认证 | 登录、注册、权限管理 | `/miniprogram/pages/auth/` |
| | 系统设置 | 公司信息、参数设置 | `/miniprogram/pages/settings/` |
| | 基础档案 | 客户、供应商、部门、人员等基础数据 | `/miniprogram/pages/basic/` |
| **财务会计** | 总账管理 | 凭证录入、审核、记账、报表 | `/miniprogram/pages/generalLedger/` |
| | 应收管理 | 应收账款、发票、收款、核销 | `/miniprogram/pages/accountsReceivable/` |
| | 应付管理 | 应付账款、发票、付款、核销 | `/miniprogram/pages/accountsPayable/` |
| | 固定资产 | 资产新增、折旧、变动、处置 | `/miniprogram/pages/fixedAssets/` |
| | 薪资管理 | 薪资计算、发放、个税申报 | `/miniprogram/pages/payroll/` |
| | 成本管理 | 成本核算、分析、控制 | `/miniprogram/pages/costManagement/` |
| **供应链** | 采购管理 | 采购订单、到货、入库、发票 | `/miniprogram/pages/purchase/` |
| | 销售管理 | 销售订单、发货、出库、发票 | `/miniprogram/pages/sales/` |
| | 库存管理 | 库存查询、调拨、盘点、预警 | `/miniprogram/pages/inventory/` |
| | 存货核算 | 入库成本、出库成本、存货报表 | `/miniprogram/pages/inventoryAccounting/` |
| **生产制造** | 生产计划 | MRP运算、生产订单、物料需求 | `/miniprogram/pages/productionPlan/` |
| | 车间管理 | 生产汇报、工序流转、派工管理 | `/miniprogram/pages/workshop/` |
| | 物料清单 | BOM维护、版本管理、用途查询 | `/miniprogram/pages/bom/` |
| **人力资源** | 人员管理 | 员工档案、招聘、培训、绩效 | `/miniprogram/pages/hr/` |
| | 考勤管理 | 打卡、请假、加班、考勤报表 | `/miniprogram/pages/attendance/` |
| **分析决策** | 财务报表 | 资产负债表、利润表、现金流量表 | `/miniprogram/pages/statistics/` |
| | 业务分析 | 销售分析、采购分析、库存分析 | `/miniprogram/pages/analytics/` |
| | AI助手 | 智能分析、风险预警、税务筹划 | `/miniprogram/pages/ai-assistant/` |

## 3. 文件组织

### 3.1 目录结构

```
miniprogram/
├── app.js                 # 应用入口文件
├── app.json               # 应用配置文件
├── app.wxss               # 全局样式文件
├── components/            # 通用组件
│   ├── auth/              # 认证相关组件
│   ├── form/              # 表单相关组件
│   ├── layout/            # 布局相关组件
│   └── chart/             # 图表相关组件
├── config/                # 配置文件
│   ├── api.js             # API配置
│   ├── constant.js        # 常量定义
│   └── permission.js      # 权限配置
├── utils/                 # 工具函数
│   ├── request.js         # 网络请求
│   ├── validator.js       # 数据验证
│   ├── date.js            # 日期处理
│   └── format.js          # 数据格式化
├── services/              # 业务服务
│   ├── authService.js     # 认证服务
│   ├── financeService.js  # 财务服务
│   ├── supplyService.js   # 供应链服务
│   └── hrService.js       # 人力资源服务
├── pages/                 # 页面文件
│   ├── auth/              # 认证页面
│   ├── basic/             # 基础档案页面
│   ├── generalLedger/     # 总账页面
│   ├── accountsReceivable/ # 应收页面
│   ├── accountsPayable/   # 应付页面
│   ├── fixedAssets/       # 固定资产页面
│   ├── payroll/           # 薪资管理页面
│   ├── costManagement/    # 成本管理页面
│   ├── purchase/          # 采购管理页面
│   ├── sales/             # 销售管理页面
│   ├── inventory/         # 库存管理页面
│   ├── inventoryAccounting/ # 存货核算页面
│   ├── productionPlan/    # 生产计划页面
│   ├── workshop/          # 车间管理页面
│   ├── bom/               # 物料清单页面
│   ├── hr/                # 人员管理页面
│   ├── attendance/        # 考勤管理页面
│   ├── statistics/        # 财务报表页面
│   ├── analytics/         # 业务分析页面
│   ├── ai-assistant/      # AI助手页面
│   └── settings/          # 系统设置页面
└── data/                  # 数据文件
    ├── basic/             # 基础数据
    ├── finance/           # 财务数据
    ├── supply/            # 供应链数据
    └── hr/                # 人力资源数据
```

### 3.2 页面文件结构

每个页面都包含以下文件：

- `index.js` - 页面逻辑文件
- `index.json` - 页面配置文件
- `index.wxml` - 页面结构文件
- `index.wxss` - 页面样式文件

对于复杂页面，采用以下结构：

```
page-name/
├── index.js              # 主页面逻辑
├── index.json            # 主页面配置
├── index.wxml            # 主页面结构
├── index.wxss            # 主页面样式
├── components/           # 页面级组件
└── utils/                # 页面级工具函数
```

## 4. 数据结构设计

### 4.1 核心数据模型

#### 4.1.1 用户模型

```json
{
  "_id": "user_id",
  "username": "admin",
  "password": "encrypted_password",
  "name": "管理员",
  "role": "admin", // admin, finance, supply, hr, production
  "department": "财务部",
  "permissions": ["generalLedger", "accountsReceivable", "accountsPayable"],
  "createdAt": "2026-01-01T00:00:00Z",
  "updatedAt": "2026-01-01T00:00:00Z"
}
```

#### 4.1.2 凭证模型

```json
{
  "_id": "voucher_id",
  "voucherNo": "2026010001",
  "date": "2026-01-01",
  "summary": "购买办公用品",
  "status": "draft", // draft, submitted, approved, posted
  "creator": "user_id",
  "items": [
    {
      "accountCode": "1001",
      "accountName": "库存现金",
      "debit": 0,
      "credit": 1000,
      "summary": "支付办公用品费"
    },
    {
      "accountCode": "6602",
      "accountName": "管理费用",
      "debit": 1000,
      "credit": 0,
      "summary": "办公用品费"
    }
  ],
  "createdAt": "2026-01-01T00:00:00Z",
  "updatedAt": "2026-01-01T00:00:00Z"
}
```

#### 4.1.3 供应商模型

```json
{
  "_id": "supplier_id",
  "code": "S001",
  "name": "用友软件股份有限公司",
  "contact": "张三",
  "phone": "13800138000",
  "address": "北京市海淀区北清路68号",
  "bank": "工商银行北京分行",
  "bankAccount": "6222020200012345678",
  "taxNo": "911100007109291097",
  "status": "active",
  "createdAt": "2026-01-01T00:00:00Z",
  "updatedAt": "2026-01-01T00:00:00Z"
}
```

#### 4.1.4 客户模型

```json
{
  "_id": "customer_id",
  "code": "C001",
  "name": "腾讯科技有限公司",
  "contact": "李四",
  "phone": "13900139000",
  "address": "深圳市南山区科技园",
  "bank": "招商银行深圳分行",
  "bankAccount": "6225887812345678",
  "taxNo": "9144030071526726XG",
  "status": "active",
  "createdAt": "2026-01-01T00:00:00Z",
  "updatedAt": "2026-01-01T00:00:00Z"
}
```

#### 4.1.5 存货模型

```json
{
  "_id": "inventory_id",
  "code": "I001",
  "name": "笔记本电脑",
  "spec": "ThinkPad X1",
  "unit": "台",
  "category": "电子设备",
  "price": 8999,
  "stock": 100,
  "minStock": 10,
  "maxStock": 200,
  "status": "active",
  "createdAt": "2026-01-01T00:00:00Z",
  "updatedAt": "2026-01-01T00:00:00Z"
}
```

## 5. 功能模块详细设计

### 5.1 财务会计模块

#### 5.1.1 总账管理

- **功能描述**：处理企业的全部账务，包括凭证录入、审核、记账、结账等。
- **核心功能**：
  - 凭证管理：录入、修改、删除、查询凭证
  - 凭证审核：审核凭证的合法性和准确性
  - 记账：将凭证数据登记到总账和明细账
  - 结账：月末结账，生成财务报表
  - 账簿查询：总账、明细账、日记账、余额表
  - 科目管理：新增、修改、删除会计科目

#### 5.1.2 应收应付管理

- **功能描述**：管理企业的应收账款和应付账款，包括发票管理、收款付款、核销等。
- **核心功能**：
  - 发票管理：录入、审核、查询销售发票和采购发票
  - 收款付款：登记收款和付款记录
  - 核销管理：核销应收账款和应付账款
  - 账龄分析：分析应收账款和应付账款的账龄
  - 对账单：生成客户和供应商对账单

#### 5.1.3 固定资产管理

- **功能描述**：管理企业的固定资产，包括资产新增、折旧、变动、处置等。
- **核心功能**：
  - 资产新增：录入新增固定资产
  - 折旧计提：自动计提固定资产折旧
  - 资产变动：处理资产的原值、使用部门、使用状况等变动
  - 资产处置：处理资产的报废、出售、捐赠等
  - 资产查询：查询固定资产卡片和折旧情况

### 5.2 供应链管理模块

#### 5.2.1 采购管理

- **功能描述**：管理企业的采购业务，包括采购订单、到货、入库、发票等。
- **核心功能**：
  - 采购订单：创建、审核、查询采购订单
  - 到货管理：登记到货信息
  - 入库管理：处理采购入库
  - 发票管理：录入采购发票
  - 采购分析：分析采购价格、供应商绩效等

#### 5.2.2 销售管理

- **功能描述**：管理企业的销售业务，包括销售订单、发货、出库、发票等。
- **核心功能**：
  - 销售订单：创建、审核、查询销售订单
  - 发货管理：登记发货信息
  - 出库管理：处理销售出库
  - 发票管理：录入销售发票
  - 销售分析：分析销售业绩、客户绩效等

#### 5.2.3 库存管理

- **功能描述**：管理企业的库存，包括库存查询、调拨、盘点、预警等。
- **核心功能**：
  - 库存查询：查询实时库存和库存变动
  - 调拨管理：处理库存调拨
  - 盘点管理：定期盘点库存
  - 预警管理：设置库存预警，避免库存不足或积压
  - 库存报表：生成库存报表

### 5.3 生产制造模块

#### 5.3.1 生产计划

- **功能描述**：管理企业的生产计划，包括生产订单、物料需求计划等。
- **核心功能**：
  - 生产订单：创建、审核、查询生产订单
  - MRP运算：根据销售订单和库存情况，计算物料需求
  - 生产排产：安排生产任务和生产时间

#### 5.3.2 车间管理

- **功能描述**：管理企业的车间生产，包括生产汇报、工序流转等。
- **核心功能**：
  - 生产汇报：汇报生产进度和生产数量
  - 工序流转：处理工序间的物料流转
  - 派工管理：安排工人和设备的生产任务

### 5.4 人力资源模块

#### 5.4.1 人员管理

- **功能描述**：管理企业的员工信息，包括员工档案、招聘、培训、绩效等。
- **核心功能**：
  - 员工档案：维护员工的基本信息
  - 招聘管理：处理招聘需求和招聘流程
  - 培训管理：安排员工培训和培训记录
  - 绩效管理：设置绩效目标和评估绩效

#### 5.4.2 考勤管理

- **功能描述**：管理企业的员工考勤，包括打卡、请假、加班等。
- **核心功能**：
  - 打卡管理：记录员工的打卡时间
  - 请假管理：处理员工的请假申请
  - 加班管理：记录员工的加班情况
  - 考勤报表：生成考勤报表

## 6. 权限管理

### 6.1 角色定义

| 角色 | 权限范围 |
|------|----------|
| 系统管理员 | 所有模块的所有权限 |
| 财务主管 | 财务会计模块的所有权限 |
| 财务人员 | 财务会计模块的部分权限 |
| 采购主管 | 采购管理模块的所有权限 |
| 销售人员 | 销售管理模块的部分权限 |
| 仓库管理员 | 库存管理模块的所有权限 |
| 生产主管 | 生产制造模块的所有权限 |
| 人力资源主管 | 人力资源模块的所有权限 |
| 普通员工 | 有限的查询权限 |

### 6.2 权限控制

- **页面级权限**：控制用户是否可以访问某个页面
- **功能级权限**：控制用户是否可以执行某个功能
- **数据级权限**：控制用户是否可以查看或修改某个数据

## 7. 数据安全

### 7.1 安全措施

- **数据加密**：敏感数据加密存储
- **访问控制**：严格的权限管理
- **数据备份**：定期备份数据
- **日志记录**：记录关键操作日志
- **网络安全**：使用HTTPS协议

### 7.2 数据备份

- **自动备份**：每天自动备份数据
- **手动备份**：支持手动备份数据
- **备份恢复**：支持从备份中恢复数据

## 8. 性能优化

### 8.1 前端优化

- **代码压缩**：压缩JavaScript和CSS代码
- **图片优化**：优化图片大小和格式
- **页面缓存**：缓存不经常变化的页面
- **懒加载**：延迟加载非关键资源

### 8.2 后端优化

- **数据库索引**：为常用查询字段创建索引
- **查询优化**：优化数据库查询语句
- **缓存策略**：缓存常用数据
- **异步处理**：使用异步处理耗时操作

## 9. 部署与维护

### 9.1 部署流程

1. **开发环境**：本地开发和测试
2. **测试环境**：集成测试和性能测试
3. **生产环境**：正式部署和发布

### 9.2 维护策略

- **定期更新**：定期更新系统功能和修复bug
- **监控系统**：监控系统运行状态
- **故障处理**：及时处理系统故障
- **用户培训**：为用户提供系统使用培训

## 10. 总结

本架构设计基于用友U8系统的功能模块，结合小程序的特点，设计了一套完整的企业管理系统架构。系统涵盖了企业管理的各个方面，为企业提供全方位的管理解决方案。同时，系统采用了现代化的技术架构和设计理念，确保系统的可扩展性、可维护性和安全性。